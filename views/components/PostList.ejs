


<div id="postlist"></div>

<div id="loading" class="ploader">Loading...</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const postlist = document.getElementById("postlist");
  const loading = document.getElementById("loading");

  let page = 1;
  let isLoading = false;
  let hasMore = true;

  async function postfetch() {
    if (isLoading || !hasMore) return;

    isLoading = true;
    loading.style.display = "block";

    try {
      const res = await fetch(`/admin/data?page=${page}`);
      const posts = await res.json();

      if (posts.length === 0) {
        hasMore = false;
        loading.innerText = "No more posts";
        return;
      }

      posts.forEach(post => {
        const div = document.createElement("div");
        div.className = "post-item";

        div.innerHTML = `
          <h3>
            <a href="/post/${post.id}" class="post-link">
              ${post.id} ${post.title}
            </a>
          </h3>
          <p>${post.content.substring(0, 120)}...</p>
        `;

        postlist.appendChild(div);
      });

      page++;

    } catch (err) {
      console.error("Load error:", err);
    } finally {
      isLoading = false;
      loading.style.display = hasMore ? "none" : "block";
    }
  }

  // âœ… Smooth & accurate scroll detection
  window.addEventListener("scroll", () => {
    const scrollTop = window.scrollY;
    const viewportHeight = window.innerHeight;
    const fullHeight = document.documentElement.scrollHeight;

    if (scrollTop + viewportHeight >= fullHeight - 120) {
      postfetch();
    }
  });

  // Initial load
  postfetch();

});
</script>