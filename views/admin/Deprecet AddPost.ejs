<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quill Editor Dark Mode</title>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css" rel="stylesheet">

<style>
:root {
  --bg: #f4f6f9;
  --card: #ffffff;
  --text: #111827;
  --border: #e5e7eb;
  --primary: #6366f1;
}

body.dark {
  --bg: #0f172a;
  --card: #020617;
  --text: #e5e7eb;
  --border: #1e293b;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 16px;
  transition: .3s;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

h1 { font-size: 20px; }

.toggle {
  background: var(--card);
  border: 1px solid var(--border);
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  border: 1px solid var(--border);
  overflow: hidden;
}

.card-header {
  padding: 10px 14px;
  font-weight: 600;
  border-bottom: 1px solid var(--border);
}

#editor { height: 280px; }
#preview { padding: 14px; }

/* Image styling */
#preview img {
  max-width: 100%;
  border-radius: 10px;
  margin: 10px 0;
  box-shadow: 0 5px 15px rgba(0,0,0,.15);
}

pre {
  position: relative;
  padding: 14px;
  border-radius: 10px;
  overflow-x: auto;
}

.copy-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: var(--primary);
  color: #fff;
  border: none;
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 6px;
  cursor: pointer;
  opacity: 0;
}

pre:hover .copy-btn { opacity: 1; }

.copy-btn.copied { background: #22c55e; }

@media (max-width: 768px) {
  .container { grid-template-columns: 1fr; }
  #editor { height: 240px; }
}
</style>
</head>

<body>

<header>
  <h1>Quill Code Editor</h1>
<div>
    <button class="toggle" onclick="toggleDark()">ðŸŒ™</button>
    <button class="toggle" onclick="saveContent()">ðŸ’¾ Save</button>
  </div>
</header>

<div class="container">
  <div class="card">
    <div class="card-header">Editor</div>
    <div id="editor"></div>
  </div>

  <div class="card">
    <div class="card-header">Preview</div>
    <div id="preview"></div>
  </div>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<script>
const quill = new Quill('#editor', {
  theme: 'snow',
  modules: {
    toolbar: {
      container: [
        ['bold','italic','underline','code-block'],
        [{ list: 'ordered' }, { list: 'bullet' }],
        ['image'],
        ['clean'],
        [{ color: [] }, { background: [] }], // â­ color add
      ],
      handlers: {
        image: imageHandler
      }
    }
  }
});

/* Image upload handler */
function imageHandler() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.click();

  input.onchange = () => {
    const file = input.files[0];
    const reader = new FileReader();

    reader.onload = () => {
      const range = quill.getSelection();
      quill.insertEmbed(range.index, 'image', reader.result);
    };

    reader.readAsDataURL(file);
  };
}

quill.on('text-change', () => {
  const preview = document.getElementById('preview');
  preview.innerHTML = quill.root.innerHTML;

  preview.querySelectorAll('pre.ql-syntax').forEach(block => {
    hljs.highlightElement(block);

    if (!block.querySelector('.copy-btn')) {
      const btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.textContent = 'Copy';

      btn.onclick = () => {
        navigator.clipboard.writeText(block.innerText);
        btn.textContent = 'Copied';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'Copy';
          btn.classList.remove('copied');
        }, 1200);
      };

      block.appendChild(btn);
    }
  });
});

function toggleDark() {
  document.body.classList.toggle('dark');
}


function saveContent() {
  const content = quill.root.innerHTML;

  fetch('savepost', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ content })
  })
  .then(res => res.json())
  .then(() => {
    alert('Content saved successfully!');
  });
}
</script>

</body>
</html>