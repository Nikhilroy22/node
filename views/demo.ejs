<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Splash Screen Loading</title>
<style>
  body, html { margin:0; padding:0; height:100%; }
  .splash-screen {
    position: fixed; top:0; left:0;
    width:100%; height:100%;
    background:#073615;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    color:#fff;
    font-family:sans-serif;
  }

  .loader-bar {
    width: 300px;
    height: 20px;
    border:1px solid #fff;
    border-radius: 10px;
    margin-top: 20px;
    overflow:hidden;
  }

  .loader-fill {
    height:100%;
    width:0;
    background:linear-gradient(90deg,#2a8f43,#1f7a34);
    transition: width 0.2s ease;
  }

  .hidden { display:none; }
</style>
</head>
<body>

<div id="splash" class="splash-screen">
    <h1>Casino Game</h1>
    <div class="loader-bar">
        <div id="loaderFill" class="loader-fill"></div>
    </div>
    <p id="progressText">0%</p>
</div>

<div id="mainContent" class="hidden">
    <h2>Welcome to the Game!</h2>
</div>

<script>
const loaderFill = document.getElementById('loaderFill');
const progressText = document.getElementById('progressText');
const splash = document.getElementById('splash');
const mainContent = document.getElementById('mainContent');

const evtSource = new EventSource('/ping');

evtSource.onmessage = function(e) {
    const progress = parseInt(e.data);
    loaderFill.style.width = progress + '%';
    progressText.textContent = progress + '%';

    if(progress >= 100) {
        splash.classList.add('hidden');
        mainContent.classList.remove('hidden');
        evtSource.close();
    }
}

evtSource.onerror = function() {
    progressText.textContent = "Network Error!";
}
</script>
<div id="networkStatus" style="position:fixed;top:10px;right:10px;padding:8px 12px;border-radius:6px;background:#333;color:#fff;font-weight:bold;">Checking...</div>

<script>
const statusDiv = document.getElementById("networkStatus");

// Ping function
async function pingServer(url = "/ping2") {
    const start = Date.now();
    try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 3000); // 3s timeout

        const resp = await fetch(url, { method: "HEAD", signal: controller.signal });
        clearTimeout(timeout);

        const duration = Date.now() - start;

        if(!resp.ok) throw new Error("Server not ok");

        if(duration < 200) {
            statusDiv.textContent = "Network: Good";
            statusDiv.style.background = "green";
        } else if(duration < 1000) {
            statusDiv.textContent = "Network: Slow";
            statusDiv.style.background = "orange";
        } else {
            statusDiv.textContent = "Network: Very Slow";
            statusDiv.style.background = "red";
        }

    } catch(err) {
        statusDiv.textContent = "No Internet";
        statusDiv.style.background = "#900";
    }
}

// Repeat every 3s
setInterval(pingServer, 3000);
pingServer();
</script>

</body>
</html>